
# https://www.youtube.com/watch?v=Nle8PcBSXrk
# https://codewithsusan.com/notes/https-apache << Can subscribe to notes
# Both of these files are located: /etc/apache2/sites-available

# demo.codewithsusan.com.conf

<VirtualHost *:80>
    ServerAdmin <email address>
    DocumentRoot /var/www/demo.codewithsusan.com

    <Directory /var/www/demo.codewithsusan.com/>
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>

    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined

    <IfModule mod_dir.c>
        DirectoryIndex index.html index.php
    </IfModule>

RewriteEngine on
RewriteCond ${SERVER_NAME} =demo.codewithsusan.com
RewriteRule ^ https://%{SERVER_NAME}%{REQUEST_URI} [END,NE,R=permanent]
</VirtualHost>

# demo.codewithsusan.com-le-ssl.conf

<IfModule mod_ssl.c>
<VirtualHost *:443>
    ServerAdmin <email address>
    DocumentRoot /var/www/demo.codewithsusan.com

    <Directory /var/www/demo.codewithsusan.com/>
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>

    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined

    <IfModule mod_dir.c>
        DirectoryIndex index.html index.php
    </IfModule>

ServerName demo.codewithsusan.com
SSLCertificateFile /etc/letsencrypt/live/demo.codewithsusan.com/fullchain.pem
SSLCertificateKeyFile /etc/letsencrypt/live/demo.codewithsusan.com/privkey.pem
Include /etc/letsencrypt/options-ssl-apache.conf

</VirtualHost>
</IfModule>

**************************************************************************
# https://www.youtube.com/watch?v=SbNiRWckZWE&t=588s

In this video, I'll show you how to install an SSL certificate on your Apache HTTP server. This step-by-step guide is simple to follow and will help you protect your website from cyber-attacks.

If you're hosting a website on Apache, it's important to install an SSL certificate. This video will show you how to do this quickly and easily, so that your website is safe from cyber-attacks. Don't wait any longer, install your SSL certificate today!

-----------------------------------
LINKS
----------------------------------
Install Apache HTTPD Manually:     • How to Install and Configure Apache HTTPD ...  
MOD_SSL Plugin: https://httpd.apache.org/docs/2.4/mod...
Install Rocky Linux 9:    • How to install Rocky Linux 9 in VMware Fus...  
 
Chapters
0:00 - Intro
0:33 - what is SSL certificate
1:43 - How to get SSL certificate
3:13 - what is self signed certificate
5:55 - create self signed certificate using openssl
9:48 - Install self signed certificate in apache httpd 2.4
12:01 - ssl certificate testing

openssl genrsa -out server.key 2048
openssl req -new -key server.key -out server.csr  <Fill out form>

# To see contents of .csr file:
openssl req -in server.csr -text

# To generate certificate:
openssl x509 -req -in server.csr -signkey server.key -days 365 -out server.crt

# To see contents of .crt file:
openssl x509 -in server.crt -text

# Install in httpd.conf
apachectl -M | grep ssl <Should display 'ssl_module (shared)'>

sudo vi conf/httpd.conf

Change: listen 80 -> listen 443
Add: SSLEngine on
     SSLCertificateFile <absolute path to /etc/httpd/certs/>/server.crt
     SSLCertificateKeyFile  <absolute path to>/server.key

systemctl restart httpd
systemctl status httpd

**************************************************************************
# Nerd on the Street - nerdonthestreet.com
# https://www.youtube.com/watch?v=x5fWSWdM4F8

<VirtualHost *:80>
    ServerName myapp.nerdonthestreet.com
    ServerAlias www.myapp.nerdonthestreet.com

    ServerAdmin jacob@nerdonthestreet.com
    DocumentRoot /var/www/myapp

    # Kind of optional... ??
    <Directory /var/www/myapp>
        AllowOverride All  # Will override locally created .htaccess file
    </Directory>

    ErrorLog ${APACHE_LOG_DIR}/error-myapp.log
    CustomLog ${APACHE_LOG_DIR}/access-myapp.log combined
    
<VirtualHost>

# a2ensite myapp.conf << Available on RH??
# a2dissite myapp     << Disables the above
# Or just use ln -s ./sites-available/myapp.conf ./sites-enabled/myapp.conf

cat ./sites-enabled/* | grep VirtualHost
apache2ctl -S  << Shows configuration errors

**************************************************************************

# Mostly useless
https://devtutorial.io/how-to-install-lets-encrypt-ssl-in-apache-on-rocky-linux-9-p3352.html

sudo nano /etc/httpd/conf.d/example.devtutorial.io.conf

<VirtualHost *:80>
    ServerAdmin webmaster@devtutorial.io
    DocumentRoot /var/www/html/example.devtutorial.io
    ServerName example.devtutorial.io

    ErrorLog /var/log/httpd/example.devtutorial.io_error.log
    CustomLog /var/log/httpd/example.devtutorial.io_access.log combined

    <Directory /var/www/html/example.devtutorial.io>
        AllowOverride All
    </Directory>
</VirtualHost>

sudo mkdir /var/www/html/example.devtutorial.io
sudo nano /var/www/html/example.devtutorial.io/index.html

sudo systemctl restart httpd

sudo certbot --apache -d example.devtutorial.io
sudo certbot renew --dry-run

**************************************************************************

https://www.golinuxcloud.com/install-certbot-rocky-linux-9/

$ sudo dnf install epel-release mod_ssl -y
sudo dnf install certbot python3-certbot-apache -y

The installation of the packages is complete. We will use the certbot command for the 
Letsencrypt installation steps. This command has 3 different uses, you can choose your wish:

    General/Simple use:             certbot --apache
    Usage by specifying a website:  certbot --apache -d website.com
    Multiple websites are written after the command:  certbot --apache -d website.com -d www.website2.com

Using simple command:
certbot --apache

# Removing a cert
sudo certbot delete --cert-name example.com

**************************************************************************
# https://rldocs.readthedocs.io/en/latest/guides/generating_ssl_keys_lets_encrypt/

<VirtualHost *:80>
        ServerName www.yourdomain.com 
        ServerAdmin username@rockylinux.org
        Redirect / https://www.yourdomain.com/
</VirtualHost>
<Virtual Host *:443>
        ServerName www.yourdomain.com 
        ServerAdmin username@rockylinux.org
        DocumentRoot /var/www/sub-domains/com.yourdomain.www/html
        DirectoryIndex index.php index.htm index.html
        Alias /icons/ /var/www/icons/
        # ScriptAlias /cgi-bin/ /var/www/sub-domains/com.yourdomain.www/cgi-bin/

    CustomLog "/var/log/httpd/com.yourdomain.www-access_log" combined
    ErrorLog  "/var/log/httpd/com.yourdomain.www-error_log"

        SSLEngine on
        SSLProtocol all -SSLv2 -SSLv3 -TLSv1
        SSLHonorCipherOrder on
        SSLCipherSuite EECDH+ECDSA+AESGCM:EECDH+aRSA+AESGCM:EECDH+ECDSA+SHA384:EECDH+ECDSA+SHA256:EECDH+aRSA+SHA384
:EECDH+aRSA+SHA256:EECDH+aRSA+RC4:EECDH:EDH+aRSA:RC4:!aNULL:!eNULL:!LOW:!3DES:!MD5:!EXP:!PSK:!SRP:!DSS

        SSLCertificateFile /etc/letsencrypt/live/yourdomain.com/fullchain.pem
        SSLCertificateKeyFile /etc/letsencrypt/live/yourdomain.com/privkey.pem
        SSLCertificateChainFile /etc/letsencrypt/live/yourdomain.com/fullchain.pem

        <Directory /var/www/sub-domains/com.yourdomain.www/html>
                Options -ExecCGI -Indexes
                AllowOverride None

                Order deny,allow
                Deny from all
                Allow from all

                Satisfy all
        </Directory>
</VirtualHost>

**************************************************************************

# linuxtrainingacademy.com
# https://www.youtube.com/watch?v=eHVc08HVTwI
# Tutorial: Free SSL Certificate Installation in CentOS / Red Hat Enterprise Linux (RHEL)

firewall-cmd --permanent --zone=public --add-service=http
firewall-cmd --permanent --zone=public --add-service=https
firewall-cmd --reload

# checking mod_ssl
rpm -q --scripts mod_ssl | less

curl http://demo.linuxtrainingacademy.com
curl -k https://demo.linuxtrainingacademy.com

certbot --apache -d demo.linuxtrainingacademy.com

vi /etc/httpd/conf.d/ssl.conf
# Find SSL Protocol support: section
Comment: SSLProtocol all -SSLv2
Add:     SSLProtocol all -SSLv2 -SSLv3

# Find SSL Cipher Suite: section << This part may be outdated!
Comment: SSLCipherSuite xxxxxxxxxx 
Add:     SSLCipherSuite EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH

# Save & exit

apachectl configtest
systemctl restart httpd

certbot renew             << Won't renew certs that are still valid
certbot renew --dry-run   << Shows output only, but won't actually renew

systemctl start certbot-renew.timer
systemctl enable certbot-renew.timer
systemctl list-timers

**************************************************************************






















